<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PARTEZ: SECURE LINK</title>
    <style>
        /* --- ОСНОВА И ФОН --- */
        body {
            background-color: #080808;
            color: #c0c0c0;
            font-family: 'Courier New', Courier, monospace;
            margin: 0; padding: 0;
            height: 100dvh; 
            display: flex; flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        /* --- ЭФФЕКТ ШУМА --- */
        body::before {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
            opacity: 0.05;
            pointer-events: none;
            z-index: 999;
        }

        /* --- КОНТЕЙНЕР --- */
        #terminal {
            flex-grow: 1;
            display: flex; flex-direction: column;
            padding: 15px; 
            position: relative; 
            z-index: 1;
            max-width: 900px;
            margin: 0 auto;
            width: 100%;
            box-sizing: border-box;
        }

        /* --- ОКНО ЧАТА --- */
        #chat-window {
            flex-grow: 1; 
            overflow-y: auto; 
            margin-bottom: 10px; 
            display: flex; 
            flex-direction: column; 
            gap: 15px; 
            padding-right: 5px;
            scrollbar-width: none; 
        }
        #chat-window::-webkit-scrollbar { display: none; }

        /* --- СООБЩЕНИЯ --- */
        .msg-container {
            display: flex;
            flex-direction: column;
            max-width: 85%;
            position: relative;
        }

        /* Лейблы */
        .sender-label {
            font-size: 10px;
            letter-spacing: 1px;
            margin-bottom: 3px;
            opacity: 0.6;
            font-weight: bold;
            text-transform: uppercase;
        }

        .message-text {
            font-size: 16px;
            line-height: 1.4;
            padding: 6px 0;
            border-bottom: 1px solid #222;
        }

        /* SARD */
        .msg-sard { align-self: flex-start; }
        .msg-sard .sender-label { color: #d63031; }
        .msg-sard .message-text { color: #dcdcdc; }

        /* USER */
        .msg-user { align-self: flex-end; text-align: right; }
        .msg-user .sender-label { color: #0984e3; }
        .msg-user .message-text { color: #ffffff; border-bottom: 1px solid #0984e3; }

        /* Системные сообщения */
        .sys-msg { 
            align-self: center;
            color: #444; 
            font-size: 11px; 
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-top: 5px;
            margin-bottom: 10px;
            text-align: center;
        }

        /* --- ВВОД --- */
        #input-area {
            display: flex;
            align-items: center;
            border-top: 1px solid #333;
            padding-top: 15px;
            padding-bottom: 10px;
            background-color: #080808;
            min-height: 50px;
        }

        #prompt {
            color: #0984e3;
            margin-right: 10px;
            font-weight: bold;
            font-size: 14px;
        }

        input {
            background: transparent;
            border: none;
            color: #fff;
            font-family: inherit;
            font-size: 16px;
            flex-grow: 1;
            outline: none;
        }

        /* --- ШТРИХ-КОД --- */
        .barcode-box {
            margin-top: 10px;
            border: 1px solid #333;
            padding: 10px;
            background: #111;
            display: inline-block;
        }
        .barcode-btn {
            display: block;
            background: repeating-linear-gradient(90deg, #fff, #fff 2px, #000 2px, #000 4px);
            width: 100%; max-width: 220px;
            height: 40px;
            opacity: 0.9;
            transition: opacity 0.3s;
            cursor: pointer;
            border: none;
        }
        .barcode-btn:hover { opacity: 0.7; }

    </style>
</head>
<body>

    <div id="terminal">
        <div id="chat-window">
            <div class="sys-msg">SECURE CONNECTION ESTABLISHED</div>
        </div>

        <div id="input-area">
            <span id="prompt">USER >></span>
            <input type="text" id="user-input" autocomplete="off" placeholder="..." autofocus>
        </div>
    </div>

    <script>
        // ==========================================
        //  НАСТРОЙКИ СИСТЕМЫ
        // ==========================================
        
        const API_KEY = "AIzaSyAFb70qkwKrRktwu-ZDjKl-9vdI4meE1WI"; // <--- ВАШ КЛЮЧ
        const TIMER_URL = "timer.html"; 

        const SYSTEM_INSTRUCTION = `
        ТВОЯ РОЛЬ: Ты — SARD. Закрытый аналитический модуль.
        ТВОЙ СТИЛЬ: Лаконичный. Сухой. Ты не болтлив. Ты не объясняешь очевидное.
        ТВОЕ ПОВЕДЕНИЕ: Ты ведешь себя как живой человек, которому немного скучно или который занят делом.
        
        ЗАДАЧА: Понять, кто перед тобой. Задавай короткие, точные вопросы.
        
        ТРИГГЕР: Если пользователь пишет "я хочу выйти из под контроля" (в любом регистре):
        1. Выведи только тег: [BARCODE_ACCESS]
        2. Следующей строкой напиши: "Добро пожаловать в ANTI."
        `;

        // ==========================================

        const chatWindow = document.getElementById('chat-window');
        const userInput = document.getElementById('user-input');
        let chatHistory = [];
        let activeModelName = "gemini-1.5-flash";

        // Первая фраза САРДА (ИЗМЕНЕНО)
        setTimeout(() => {
            appendMessage("SARD", "Зачем ты здесь?", "sard");
        }, 1500); // Пауза при старте 1.5 сек

        // Обработка ввода
        userInput.addEventListener('keypress', async function (e) {
            if (e.key === 'Enter') {
                const text = userInput.value.trim();
                if (!text) return;

                appendMessage("USER", text, "user");
                userInput.value = '';
                userInput.disabled = true;

                try {
                    const reply = await getGeminiResponse(text);
                    
                    // Имитация задержки мышления (от 1 до 3 секунд)
                    const thinkingTime = Math.random() * 2000 + 1000;
                    
                    setTimeout(() => {
                        processReply(reply);
                        userInput.disabled = false;
                        userInput.focus();
                    }, thinkingTime);

                } catch (error) {
                    appendMessage("SYSTEM", "CONNECTION_ERROR: " + error.message, "sys");
                    userInput.disabled = false;
                }
            }
        });

        function appendMessage(senderName, text, type) {
            const container = document.createElement('div');
            container.classList.add('msg-container');
            
            if (type === 'user') container.classList.add('msg-user');
            else if (type === 'sard') container.classList.add('msg-sard');
            else container.classList.add('sys-msg');

            if (type !== 'sys') {
                const label = document.createElement('div');
                label.classList.add('sender-label');
                label.innerText = senderName; 

                const msgText = document.createElement('div');
                msgText.classList.add('message-text');

                if (type === 'sard') {
                    container.appendChild(label);
                    container.appendChild(msgText);
                    chatWindow.appendChild(container);
                    // Скорость печати регулируется внутри typeWriter
                    typeWriter(text, msgText);
                } else {
                    msgText.innerText = text;
                    container.appendChild(label);
                    container.appendChild(msgText);
                    chatWindow.appendChild(container);
                }
            } else {
                container.innerText = text;
                chatWindow.appendChild(container);
            }
            
            scrollToBottom();
        }

        // Эффект медленной печати
        function typeWriter(text, element) {
            let i = 0;
            // Скорость печати: 60мс. Медленно и "человечно"
            const typingSpeed = 60; 

            function type() {
                if (i < text.length) {
                    element.textContent += text.charAt(i);
                    i++;
                    scrollToBottom();
                    setTimeout(type, typingSpeed); 
                }
            }
            type();
        }

        function scrollToBottom() {
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        function processReply(text) {
            if (text.includes("[BARCODE_ACCESS]")) {
                const container = document.createElement('div');
                container.classList.add('msg-container', 'msg-sard');
                
                const label = document.createElement('div');
                label.classList.add('sender-label');
                label.innerText = "SARD [SECURITY_OVERRIDE]";
                label.style.color = "#ff0000";

                const box = document.createElement('div');
                box.className = 'barcode-box';
                
                const link = document.createElement('a');
                link.href = TIMER_URL;
                link.className = 'barcode-btn';
                link.target = "_blank";
                
                const welcomeText = document.createElement('div');
                welcomeText.style.marginTop = "10px";
                welcomeText.style.color = "#fff";
                welcomeText.innerText = "Добро пожаловать в ANTI.";

                box.appendChild(link);
                box.appendChild(welcomeText);
                
                container.appendChild(label);
                container.appendChild(box);
                chatWindow.appendChild(container);
                scrollToBottom();
            } else {
                appendMessage("SARD", text, "sard");
            }
        }

        async function getGeminiResponse(userText) {
            if (API_KEY.includes("ВСТАВЬ")) throw new Error("API KEY MISSING");

            const url = `https://generativelanguage.googleapis.com/v1beta/models/${activeModelName}:generateContent?key=${API_KEY}`;
            chatHistory.push({ role: "user", parts: [{ text: userText }] });

            const payload = {
                contents: [
                    { role: "user", parts: [{ text: "SYSTEM: " + SYSTEM_INSTRUCTION }] },
                    ...chatHistory
                ]
            };

            const response = await fetch(url, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });

            if (!response.ok) throw new Error("Server Reject");

            const data = await response.json();
            const reply = data.candidates[0].content.parts[0].text;
            chatHistory.push({ role: "model", parts: [{ text: reply }] });
            
            return reply;
        }
    </script>
</body>
</html>
